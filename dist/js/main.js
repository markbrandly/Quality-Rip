!function(){function t(t){var e=document.getElementsByClassName(t);return{items:e,click:function(t){for(var e=this.items.length-1;e>=0;e--)this.items[e].onclick=t}}}function e(t){t.parentNode.removeChild(t)}function o(t){var e=document.cookie.split(t+"=");return 2==e.length?e.pop().split(";").shift():!1}function n(t){document.cookie=encodeURIComponent(t)+"=deleted; expires="+new Date(0).toUTCString()}function i(t){if(t){for(var e,o=t.split("?")[1]||"",n=o.split("&"),i={},a=n.length-1;a>=0;a--)e=n[a].split("="),i[e[0]]=e[1];return i}}function a(t,e){o(t)?e():setTimeout(function(){a(t,e)},1e3)}var r=function(){for(var t="",e="0123456789abcdef",o=0;16>o;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},d=angular.module("yt-dl",["ngAnimate"]);d.controller("ctrl",["$scope","$http","$sce","$timeout",function(o,d,l,c){function s(){if(o.vidData){var t=i(location.href);t.v!==o.vidData.id?history.pushState({state:1},"","?v="+o.vidData.id):history.replaceState({state:1},"","?v="+o.vidData.id),console.log("updating")}}function u(){if(o.vidData&&o.vidData.display_id){var t=o.trustSrc("https://www.youtube.com/embed/"+o.vidData.display_id),e='<iframe src="'+t+'" frameborder="0" allowfullscreen></iframe>',n=document.getElementsByClassName("video-wrapper")[0];n&&(n.innerHTML=e)}}function f(){var t=i(location.href);t.v&&(o.search="https://www.youtube.com/watch?v="+t.v,o.findVideo())}o.trustSrc=function(t){return l.trustAsResourceUrl(t)},o.fileTypes=[{name:"mp4",type:"video"},{name:"ogg",type:"video"},{name:"mp3",type:"audio"}],o.download=function(t){var o=document.createElement("iframe"),i=r();o.setAttribute("class","hidden"),o.setAttribute("src","download?id="+t+"&token="+i),console.log(o),document.body.appendChild(o),a(i,function(){alert("ready to download"),n(i),e(o)})},o.resetData=function(){o.vidData=null},o.findVideo=function(){var t=o.search;o.loadVideo(t)},o.loadVideo=function(t){o.loading=!0;var e={method:"GET",url:"http://localhost:3000/videoJson?url="+t,headers:{}};d(e).success(function(t){o.loading=!1,o.vidData&&o.vidData.display_id===t.display_id||(o.vidData=t,console.log(JSON.stringify(t,null,2)),t.webpage_url&&(o.search=t.webpage_url,s(),c(u)))})},f(),window.onpopstate=function(t){t.state.state&&(console.log("dasd"),f()),console.log(t),console.log(t.state.state)},t("embed").click(function(t){console.log(t)})}])}();