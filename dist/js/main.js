!function(){function t(t){t.parentNode.removeChild(t)}function e(t){var e=document.cookie.split(t+"=");return 2==e.length?e.pop().split(";").shift():!1}function o(t){document.cookie=encodeURIComponent(t)+"=deleted; expires="+new Date(0).toUTCString()}function n(t){if(t){for(var e,o=t.split("?")[1]||"",n=o.split("&"),a={},i=n.length-1;i>=0;i--)e=n[i].split("="),a[e[0]]=e[1];return a}}function a(t,o){e(t)?o():setTimeout(function(){a(t,o)},1e3)}var i=function(){for(var t="",e="0123456789abcdef",o=0;16>o;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},r=angular.module("yt-dl",["ngAnimate"]);r.controller("ctrl",["$scope","$http","$sce","$timeout",function(e,r,d,l){function c(){if(e.vidData){var t=n(location.href);t.v!==e.vidData.id?history.pushState({state:1},"","?v="+e.vidData.id):history.replaceState({state:1},"","?v="+e.vidData.id),console.log("updating")}}function s(){if(e.vidData&&e.vidData.display_id){var t=e.trustSrc("https://www.youtube.com/embed/"+e.vidData.display_id),o='<iframe src="'+t+'" frameborder="0" allowfullscreen></iframe>',n=document.getElementsByClassName("video-wrapper")[0];n&&(n.innerHTML=o)}}function u(){var t=n(location.href);t.v&&(e.search="https://www.youtube.com/watch?v="+t.v,e.findVideo())}e.trustSrc=function(t){return d.trustAsResourceUrl(t)},e.fileTypes=[{name:"mp4",type:"video"},{name:"ogg",type:"video"},{name:"mp3",type:"audio"}],e.download=function(e){var n=document.createElement("iframe"),r=i();n.setAttribute("class","hidden"),n.setAttribute("src","download?id="+e+"&token="+r),console.log(n),document.body.appendChild(n),a(r,function(){alert("ready to download"),o(r),t(n)})},e.resetData=function(){e.vidData=null},e.findVideo=function(){var t=e.search;e.loadVideo(t)},e.loadVideo=function(t){e.loading=!0;var o={method:"GET",url:"http://localhost:3000/videoJson?url="+t,headers:{}};r(o).success(function(t){e.loading=!1,e.vidData=t,console.log(JSON.stringify(t,null,2)),t.webpage_url&&(e.search=t.webpage_url,c(),l(s))})},u(),window.onpopstate=function(t){t.state.state&&(console.log("dasd"),u()),console.log(t),console.log(t.state.state)}}])}();